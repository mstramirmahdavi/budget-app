var budgetController=function(){var e=function(e,t,n){this.id=e,this.description=t,this.value=n,this.percentage=-1};e.prototype.calcPercentages=function(e){this.percentage=e>0?Math.round(this.value/e*100):-1},e.prototype.getPercentages=function(){return this.percentage};var t=function(e,t,n){this.id=e,this.description=t,this.value=n},n=function(e){var t=0;i.allItems[e].forEach(function(e){t+=e.value}),i.totals[e]=t},i={allItems:{exp:[],inc:[]},totals:{exp:0,inc:0},budget:0,percentage:-1};return{addItem:function(n,c,a){var o,r;return r=i.allItems[n].length>0?i.allItems[n][i.allItems[n].length-1].id+1:0,"exp"===n?o=new e(r,c,a):"inc"===n&&(o=new t(r,c,a)),i.allItems[n].push(o),o},deleteItem:function(e,t){var n,c;n=i.allItems[e].map(function(e){return e.id}),c=n.indexOf(t),-1!==c&&i.allItems[e].splice(c,1)},calculateBudget:function(){n("exp"),n("inc"),i.budget=i.totals.inc-i.totals.exp,i.totals.inc>0?i.percentage=Math.round(i.totals.exp/i.totals.inc*100):i.percentage=-1},calculatePercentages:function(){i.allItems.exp.forEach(function(e){e.calcPercentages(i.totals.inc)})},getPercentages:function(){var e=i.allItems.exp.map(function(e){return e.getPercentages()});return e},getBudget:function(){return{budget:i.budget,totalInc:i.totals.inc,totalExp:i.totals.exp,percentage:i.percentage}},testing:function(){console.log(i)}}}(),UIController=function(){function e(){return{type:document.querySelector(t.inputType).value,description:document.querySelector(t.inputDescription).value,value:parseFloat(document.querySelector(t.inputValue).value)}}var t={container:".container",inputType:".add__type",inputDescription:".add__description",inputValue:".add__value",inputBtn:".add__btn",incomeContainer:".income__list",expensesContainer:".expenses__list",budgetLabel:".budget__value",incomeLabel:".budget__income--value",expensesLabel:".budget__expenses--value",percentageLabel:".budget__expenses--percentage",expensesPercentageLabel:".item__percentage",dateLabel:".budget__title--month",topRow:".top"},n=function(e,t){var n,i,c;return e=Math.abs(e),e=e.toFixed(2),n=e.split("."),i=n[0],i.length>3&&(i=(new Intl.NumberFormat).format(i)),c=n[1],("exp"===t?"-":"+")+" "+i+" . "+c+" $"},i=function(e,t){for(let n=0;n<e.length;n++)t(e[n],n)};return{getInput:e,addListItem:function(e,i){var c,a,o;"inc"===i?(o=t.incomeContainer,c='<div class="item clearfix" id="inc-%id%"><div class="item__description">%description%</div><div class="right clearfix"><div class="item__value">%value%</div><div class="item__delete"><button class="item__delete--btn"><i class="ion-ios-close-outline"></i></button></div></div></div>'):"exp"===i&&(o=t.expensesContainer,c='<div class="item clearfix" id="exp-%id%"><div class="item__description">%description%</div><div class="right clearfix"><div class="item__value">%value%</div><div class="item__percentage">21%</div><div class="item__delete"><button class="item__delete--btn"><i class="ion-ios-close-outline"></i></button></div></div></div>'),a=c.replace("%id%",e.id),a=a.replace("%description%",e.description),a=a.replace("%value%",n(e.value,i)),document.querySelector(o).insertAdjacentHTML("beforeend",a)},deleteListItems:function(e){var t=document.getElementById(e);t.parentNode.removeChild(t)},clearFields:function(){var e,n;e=document.querySelectorAll(t.inputDescription+", "+t.inputValue),n=Array.prototype.slice.call(e),n.forEach(function(e){e.value=""}),n[0].focus()},displayBudget:function(e){var i;i=e.budget>0?"inc":"exp",document.querySelector(t.budgetLabel).textContent=n(e.budget,i),document.querySelector(t.expensesLabel).textContent=n(e.totalExp,"exp"),document.querySelector(t.incomeLabel).textContent=n(e.totalInc,"inc"),e.percentage>0?document.querySelector(t.percentageLabel).textContent=e.percentage+"%":document.querySelector(t.percentageLabel).textContent="---"},displayPercentages:function(e){var n=document.querySelectorAll(t.expensesPercentageLabel);i(n,function(t,n){e[n]>0?t.textContent=e[n]+"%":t.textContent="---"})},displayMonth:function(){var e,n,i;const c=["January","February","March","April","May","June","July","August","September","October","November","December"];e=new Date,i=e.getMonth(),n=e.getFullYear(),document.querySelector(t.dateLabel).textContent=c[i]+" "+n},changedType:function(){var e=document.querySelectorAll(t.inputType+", "+t.inputDescription+", "+t.inputValue);i(e,function(e){e.classList.toggle("red-focus")}),document.querySelector(t.inputBtn).classList.toggle("red")},checkbudget:function(){var e=function(){document.querySelector(t.topRow).classList.remove("red"),document.querySelector(t.topRow).classList.remove("blue")},n=budgetController.getBudget().budget;n>0?(e(),document.querySelector(t.topRow).classList.add("blue")):n<0?(e(),document.querySelector(t.topRow).classList.add("red")):e()},getDOMString:function(){return t}}}(),Controller=function(e,t){var n=function(){var e=UIController.getDOMString();document.querySelector(e.inputBtn).addEventListener("click",a),document.addEventListener("keypress",function(e){13!==e.keyCode&&13!==e.which||a()}),document.querySelector(e.container).addEventListener("click",o),document.querySelector(e.inputType).addEventListener("change",t.changedType)},i=function(){e.calculateBudget();var n=e.getBudget();t.displayBudget(n),t.checkbudget()},c=function(){e.calculatePercentages();var n=e.getPercentages();t.displayPercentages(n)},a=function(){var n,a;n=t.getInput(),""!==n.description&&!isNaN(n.value)&&n.value>0&&(a=e.addItem(n.type,n.description,n.value),t.addListItem(a,n.type),t.clearFields(),i(),c())},o=function(n){var a,o,r,l;a=n.target.parentNode.parentNode.parentNode.parentNode.id,a&&(o=a.split("-"),r=o[0],l=parseInt(o[1]),e.deleteItem(r,l),t.deleteListItems(a),i(),c())};return{init:function(){t.displayBudget({budget:0,totalInc:0,totalExp:0,percentage:0}),n(),t.displayMonth(),t.checkbudget()}}}(budgetController,UIController);Controller.init();